---
import { getCollection, type CollectionEntry } from 'astro:content';
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import Hero from '@sections/marketing/Hero.astro';
import LogoCloud from '@sections/marketing/LogoCloud.astro';
import HowItWorks from '@sections/marketing/HowItWorks.astro';
import FeaturesSection from '@sections/marketing/FeaturesSection.astro';
import BentoGrid from '@sections/marketing/BentoGrid.astro';
import PricingTable from '@sections/pricing/PricingTable.astro';
import TestimonialsSection from '@sections/social-proof/TestimonialsSection.astro';
import CTA from '@sections/marketing/CTA.astro';
import { siteConfig } from '@/config';
import IntegrationsGrid from '@sections/marketing/IntegrationsGrid.astro';

type TestimonialEntry = CollectionEntry<'testimonials'>;

const EMAIL_PRICING_LINK = `https://mail.google.com/mail/u/0/?fs=1
&to=daniswastaken@gmail.com
&su=Inquiry%20About%20Snapshot%20Pricing
&body=Hi%20there%2C%0A%0AI%20hope%20you%E2%80%99re%20doing%20well.%0A%0AI%E2%80%99m%20interested%20in%20learning%20more%20about%20Snapshot%E2%80%99s%20pricing%20plans%20and%20options.%20Could%20you%20please%20share%20the%20details%20or%20let%20me%20know%20how%20to%20get%20started%3F%0A%0AThank%20you%21%0A%0ABest%20regards%2C%0A
&tf=cm`.replace(/\s+/g, "");

const EMAIL_US = `https://mail.google.com/mail/?view=cm&fs=1&to=daniswastaken@gmail.com&su=Greetings,%20Snapshot.`;

/* ---------------- CTA OBJECTS ---------------- */
const ctaAction = { label: 'Contact Sales', href: EMAIL_PRICING_LINK };

/* ---------------- TESTIMONIALS ---------------- */
const testimonials = await getCollection(
  'testimonials',
  ({ data }: { data: TestimonialEntry['data'] }) => !data.draft
);
const sortedTestimonials = [...testimonials].sort(
  (a, b) => a.data.order - b.data.order
);

/* ---------------- INTEGRATIONS ---------------- */
const integrations = [
  {
    name: 'Docker',
    logo: '/images/integrations/docker.svg',
    category: 'Infrastructure',
    featured: true,
    description: 'Full CI/CD integration with GitLab repositories.',
  },
  {
    name: 'Crafty Controller',
    logo: '/images/integrations/crafty.svg',
    category: 'Game Servers',
    featured: true,
    description: 'Get deployment notifications and alerts in your Slack channels.',
  },
  {
    name: 'CasaOS',
    logo: '/images/integrations/casaos.svg',
    category: 'Platform',
    featured: true,
    description: 'Workflow automation with n8n integrations.',
  },
];
const featuredIntegrations = integrations.filter((i) => i.featured);

/* ---------------- BENTO ---------------- */
const bentoItems = [
  {
    title: 'Smart Fallback',
    description:
      'Automatically serve a fallback when your origin server goes offline.',
    icon: 'lucide:shield-check',
    size: 'large' as const,
    accent: 'primary' as const,
  },
  {
    title: 'Live Origin Switching',
    description:
      'Traffic switches instantly between your server and fallback—no redeploys.',
    icon: 'lucide:shuffle',
    accent: 'blue' as const,
  },
  {
    title: 'Edge-First Routing',
    description:
      'Requests are routed close to users for speed and continuity.',
    icon: 'lucide:globe',
    accent: 'green' as const,
  },
  {
    title: 'Shared Control',
    description:
      'Manage Snapshots together with clear access control.',
    icon: 'lucide:users',
    size: 'medium' as const,
    accent: 'purple' as const,
  },
];

/* ---------------- FEATURES ---------------- */
const features = [
  {
    icon: 'lucide:zap',
    title: 'Instant Availability',
    description:
      'When your origin is online, traffic flows through it. When it’s not, Snapshot keeps you reachable.',
  },
  {
    icon: 'lucide:refresh-cw',
    title: 'Automatic Failover',
    description:
      'Snapshot switches to fallback automatically when downtime is detected.',
  },
  {
    icon: 'lucide:globe',
    title: 'Smart Global Routing',
    description:
      'Traffic is routed intelligently across regions for speed and reliability.',
  },
  {
    icon: 'lucide:shield',
    title: 'Always-On Protection',
    description:
      'HTTPS, DDoS mitigation, and secure routing are built in.',
  },
  {
    icon: 'lucide:bar-chart',
    title: 'Uptime & Traffic Insights',
    description:
      'See when origins serve traffic and when fallbacks activate.',
  },
  {
    icon: 'lucide:handshake',
    title: 'Simple Team Control',
    description:
      'Share access and manage configuration without complex infrastructure.',
  },
];

/* ---------------- PRICING ---------------- */
const pricingPlans = [
  {
    name: 'Hobby',
    monthlyPrice: 12,
    description: 'Perfect for side projects',
    features: ['1 projects', '50 GB bandwidth/month', 'Automatic HTTPS', 'Community support'],
    cta: { label: 'Contact Sales', href: EMAIL_PRICING_LINK },
  },
  {
    name: 'Pro',
    monthlyPrice: 30,
    description: 'For professional developers',
    features: [
      '10 projects',
      '1 TB bandwidth/month',
      'Team collaboration',
      'Priority support',
    ],
    highlighted: true,
    cta: { label: 'Contact Sales', href: EMAIL_PRICING_LINK },
  },
  {
    name: 'Enterprise',
    monthlyPrice: null,
    customPrice: 'Custom',
    description: 'For large organizations',
    features: ['Unlimited everything', 'SSO & SAML', 'SLA guarantee', 'Dedicated support'],
    cta: { label: 'Contact Sales', href: '/contact' },
  },
];
---

<MarketingLayout
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="Online, Even When Your Server Isn't"
    subtitle="Snapshot ensures your services stays online with seamless failover and smart routing."
    primaryCTA={{ label: 'Get Started', href: '#pricing' }}
    secondaryCTA={{ label: 'Contact Us', href: EMAIL_US }}
  />

  <LogoCloud
    title="Trusted by amazing teams and projects"
    logos={[
      { name: 'Logo Ipsum 1', src: '/images/logos/logoipsum-1.svg' },
      { name: 'Logo Ipsum 2', src: '/images/logos/logoipsum-2.svg' },
      { name: 'Logo Ipsum 3', src: '/images/logos/logoipsum-3.svg' },
      { name: 'Logo Ipsum 4', src: '/images/logos/logoipsum-4.svg' },
      { name: 'Logo Ipsum 5', src: '/images/logos/logoipsum-5.svg' },
      { name: 'Logo Ipsum 6', src: '/images/logos/logoipsum-6.svg' },
    ]}
    grayscale={false}
    logoSize="lg"
  />

  <section id="how-it-works">
    <HowItWorks
      title="Deploy in 3 Simple Steps"
      subtitle="From setup to global access in minutes."
      steps={[
        {
          title: 'Create a Snapshot',
          description:
            'A smart environment that fronts your server and handles fallback.',
          icon: 'lucide:server',
        },
        {
          title: 'Configure & Connect',
          description:
            'Set domains, routing rules, and fallback behavior.',
          icon: 'lucide:settings',
        },
        {
          title: 'Live & Protected',
          description:
            'Your service stays reachable even if your server goes offline.',
          icon: 'lucide:rocket',
        },
      ]}
      variant="horizontal"
      background="muted"
    />
  </section>

  <section id="integrations">
    <IntegrationsGrid
      title="Integrations"
      subtitle="Our platform integrates seamlessly with the tools for versatile use case."
      integrations={featuredIntegrations}
      variant="detailed"
      columns={3}
      background="default"
      invertOnDark={false}
    />
  </section>

  <section id="features">
    <FeaturesSection
      title="Everything You Need"
      subtitle="Reliability, routing, and control—without complexity."
      features={features}
      background="muted"
    />
  </section>

  <BentoGrid
    title="Developer-First Features"
    subtitle="Designed for self-hosters who value uptime."
    items={bentoItems}
    background="muted"
  />

  <section id="pricing">
    <PricingTable
      title="Pricing That Scales With You"
      subtitle="No surprises. No hidden costs."
      plans={pricingPlans}
      annualDiscount={20}
      background="default"
    />
  </section>

  {siteConfig.features.testimonials && sortedTestimonials.length > 0 && (
    <TestimonialsSection
      title="Loved by Everyone"
      subtitle="Trusted by teams and developers."
      background="muted"
      limit={4}
      testimonials={sortedTestimonials.map((t) => ({
        quote: t.data.quote,
        author: t.data.author,
        role: t.data.role,
        company: t.data.company,
        avatar: t.data.avatar,
      }))}
    />
  )}

  <CTA
    title="Start with Snapshot"
    description="Always reachable, even when your server isn’t."
    action={ctaAction}
  />
</MarketingLayout>
