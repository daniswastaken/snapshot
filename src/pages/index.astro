---
import { getCollection, type CollectionEntry } from 'astro:content';
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import Hero from '@sections/marketing/Hero.astro';
import LogoCloud from '@sections/marketing/LogoCloud.astro';
import HowItWorks from '@sections/marketing/HowItWorks.astro';
import FeaturesSection from '@sections/marketing/FeaturesSection.astro';
import BentoGrid from '@sections/marketing/BentoGrid.astro';
import PricingTable from '@sections/pricing/PricingTable.astro';
import TestimonialsSection from '@sections/social-proof/TestimonialsSection.astro';
import CTA from '@sections/marketing/CTA.astro';
import Newsletter from '@sections/marketing/Newsletter.astro';
import { siteConfig } from '@/config';
import IntegrationsGrid from '@sections/marketing/IntegrationsGrid.astro';

type TestimonialEntry = CollectionEntry<'testimonials'>;

const testimonials = await getCollection(
  'testimonials',
  ({ data }: { data: TestimonialEntry['data'] }) => !data.draft
);
const sortedTestimonials = [...testimonials].sort(
  (a: TestimonialEntry, b: TestimonialEntry) => a.data.order - b.data.order
);

const integrations = [
  {
    name: 'GitLab',
    logo: '/images/integrations/gitlab.svg',
    category: 'Development',
    featured: true,
    description: 'Full CI/CD integration with GitLab repositories.',
    href: '/integrations',
  },
  {
    name: 'Slack',
    logo: '/images/integrations/slack.svg',
    category: 'Communication',
    featured: true,
    description: 'Get deployment notifications and alerts in your Slack channels.',
    href: '/integrations',
  },
  {
    name: 'n8n',
    logo: '/images/integrations/n8n.svg',
    category: 'Automation',
    featured: true,
    description: 'Workflow automation with n8n integrations.',
    href: '/integrations',
  },
];

const featuredIntegrations = integrations.filter((i) => i.featured);

const bentoItems = [
  {
    title: 'Smart Fallback',
    description:
      'Automatically serve a fallback when your origin server goes offline, keeping your service reachable at all times.',
    icon: 'lucide:shield-check',
    size: 'large' as const,
    accent: 'primary' as const,
    href: '/docs/fallback',
  },
  {
    title: 'Live Origin Switching',
    description:
      'Traffic flows to your server when it’s online and switches instantly when it’s not—no redeploys required.',
    icon: 'lucide:shuffle',
    accent: 'blue' as const,
    href: '/docs/routing',
  },
  {
    title: 'Edge-First Routing',
    description:
      'Requests are handled close to users with intelligent routing for speed, reliability, and continuity.',
    icon: 'lucide:globe',
    accent: 'green' as const,
    href: '/docs/edge-routing',
  },
  {
    title: 'Shared Control',
    description:
      'Manage Snapshots together with clear access control and shared configuration across your team.',
    icon: 'lucide:users',
    size: 'medium' as const,
    accent: 'purple' as const,
    href: '/docs/teams',
  },
];

const features = [
  {
    icon: 'lucide:zap',
    title: 'Instant Availability',
    description:
      'Snapshot goes live in seconds. When your origin server is online, traffic flows through it. When it’s not, Snapshot keeps your site reachable.',
  },
  {
    icon: 'lucide:refresh-cw',
    title: 'Automatic Failover',
    description:
      'If your server goes down, Snapshot automatically switches to a fallback without manual intervention or redeploys.',
  },
  {
    icon: 'lucide:globe',
    title: 'Smart Global Routing',
    description:
      'Requests are routed intelligently across regions, ensuring fast access and seamless continuity for users worldwide.',
  },
  {
    icon: 'lucide:shield',
    title: 'Always-On Protection',
    description:
      'Built-in HTTPS, DDoS mitigation, and secure routing protect your service whether your server is online or offline.',
  },
  {
    icon: 'lucide:bar-chart',
    title: 'Uptime & Traffic Insights',
    description:
      'Understand when your origin is serving traffic, when fallbacks activate, and how users access your service.',
  },
  {
    icon: 'lucide:handshake',
    title: 'Simple Team Control',
    description:
      'Manage Snapshots together with clear access control and shared configuration—no complex infrastructure required.',
  },
];

const pricingPlans = [
  {
    name: 'Hobby',
    monthlyPrice: 0,
    description: 'Perfect for side projects',
    features: ['3 projects', '100 GB bandwidth/month', 'Automatic HTTPS', 'Community support'],
    cta: { label: 'Start Free', href: '/register' },
  },
  {
    name: 'Pro',
    monthlyPrice: 20,
    description: 'For professional developers',
    features: [
      'Unlimited projects',
      '1 TB bandwidth/month',
      'Team collaboration',
      'Priority support',
    ],
    highlighted: true,
    cta: { label: 'Start Free Trial', href: '/register' },
  },
  {
    name: 'Enterprise',
    monthlyPrice: null,
    customPrice: 'Custom',
    description: 'For large organizations',
    features: ['Unlimited everything', 'SSO & SAML', 'SLA guarantee', 'Dedicated support'],
    cta: { label: 'Contact Sales', href: '/contact' },
  },
];
---

<MarketingLayout
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="Online, Even When Your Server Isn't"
    subtitle="Snapshot ensures your services stays online with seamless failover and smart routing."
    primaryCTA={{ label: 'Get Started', href: '/register' }}
    secondaryCTA={{ label: 'Contact', href: '/dashboard' }}
  />

  <LogoCloud
    title="Trusted by amazing teams and projects"
    logos={[
      { name: 'Logo Ipsum 1', src: '/images/logos/logoipsum-1.svg' },
      { name: 'Logo Ipsum 2', src: '/images/logos/logoipsum-2.svg' },
      { name: 'Logo Ipsum 3', src: '/images/logos/logoipsum-3.svg' },
      { name: 'Logo Ipsum 4', src: '/images/logos/logoipsum-4.svg' },
      { name: 'Logo Ipsum 5', src: '/images/logos/logoipsum-5.svg' },
      { name: 'Logo Ipsum 6', src: '/images/logos/logoipsum-6.svg' },
    ]}
    grayscale={false}
    logoSize="lg"
  />

  <HowItWorks
    title="Deploy in 3 Simple Steps"
    subtitle="From dreams to production in minutes, not hours."
    steps={[
      {
        title: 'Create a Snapshot',
        description:
          'A smart environment that expands when your server is online and falls back when it’s not.',
        icon: 'lucide:server',
      },
      {
        title: 'Configure & Connect',
        description:
          'Set domains, routing rules, and fallback behavior. Customize only what you need—defaults handle the rest.',
        icon: 'lucide:settings',
      },
      {
        title: 'Deploy & Live',
        description:
          'Your site is now reachable worldwide. If your server goes offline, Snapshot automatically serves a fallback.',
        icon: 'lucide:rocket',
      },
    ]}
    variant="horizontal"
    background="muted"
  />

  <IntegrationsGrid
    title="Integrations"
    subtitle="Fully integrated and compatible with all the platform you use."
    integrations={featuredIntegrations}
    variant="detailed"
    invertOnDark={false}
    columns={3}
    background="default"
    footerLink={{ label: 'View all integrations →', href: '/integrations' }}
  />

  <FeaturesSection
    title="Everything You Need"
    subtitle="From development to production, Snapshot provides all the tools your team needs to move fast and stay online."
    features={features}
    background="muted"
  />

  <BentoGrid
    title="Developer-First Features"
    subtitle="Built by developers, for developers with ease of use and performance in mind."
    items={bentoItems}
    background="muted"
  />

  <PricingTable
    title="Pricing That Scales With You"
    subtitle="No surprises. No hidden costs."
    plans={pricingPlans}
    annualDiscount={20}
    background="default"
  />

  {
    siteConfig.features.testimonials && sortedTestimonials.length > 0 && (
      <TestimonialsSection
        title="Loved by Developers"
        subtitle="Join teams and projects powered by Snapshot."
        background="muted"
        limit={4}
        testimonials={sortedTestimonials.map((t) => ({
          quote: t.data.quote,
          author: t.data.author,
          role: t.data.role,
          company: t.data.company,
          avatar: t.data.avatar,
        }))}
      />
    )
  }

  <CTA
    title="Start with Snapshot"
    description="Turn your dreams into a reliable public endpoint—no complex setup required."
    action={{ label: 'Get Started', href: '/register' }}
  />
</MarketingLayout>
